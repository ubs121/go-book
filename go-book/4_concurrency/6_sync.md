#  Синхрончлох

Go функцүүдийн нөөцийн төлөө өрсөлдөөнийг зохицуулах хэд хэдэн арга бий.

Нэгдүгээрт суваг ашиглаж болно. Сувгийн зориулалт нь go функцүүдийн хооронд мессеж/өгөгдөл дамжуулах гэдгийг бид мэднэ. Үүнээс өөрөөр мөн go функцүүдийг зохицуулах (синхрончлох) зорилгоор ашиглаж болно. Тухайлбал суваг ашиглан нэг go функцийн ажил дуусахыг хүлээх, дууссан үед нь бусад go функцэд мэдээлдэг байж болно.

```go
func worker(done chan bool) {
    fmt.Print("working...")
    time.Sleep(time.Second)

    // ажил дууссан болохыг бусдад мэдээлэх
    done <- true
}

func main() {
    // зохицуулагч суваг үүсгэх
    done := make(chan bool, 1)

    // функцийг эхлүүлэх
    go worker(done)

    // ажил дуусахыг хүлээх
    <-done

    // ... бусад функц ажлаа эхэлж болно
}
```

Энэ жишээний `done` суваг нь өгөгдөл дамжуулах зорилготой биш, зөвхөн ажил дууссан тухай дохио өгөх зорилготой байна.

Зарим тохиолдолд сувгийн оронд зохицуулагч обект ашиглан өгөгдлийн хандалтыг синхрончлох нь оновчтой байдаг. Энэ зорилгоор `sync.Mutex` обектыг ашиглаж болно.

Энэ төрлийн синхрончлолд дундын нөөц рүү тухайн мөчид зөвхөн нэг go функц хандахыг зөвшөөрдөг. Хэрэв тэр нэг go функц нь алдаа гаргавал түгжрэх нөхцөл үүсэж болно гэдгийг анхаарах хэрэгтэй. Тийм учраас өгөгдлийн бүтцээ синхрончлолд зориулан нарийн зохиомжлох хэрэгтэй.

Дараах жишээнд `AtomicInt` нэртэй бүхэл тоо хадгалах бүтэц үүсгэсэн байна. Энэ бүтцийн `Add`, `Value` методоор дамжуулан түүний бүхэл тоон талбар руу олон go функц  аюулгүй  хандах боломжтой.

```go
type AtomicInt struct {
    mu sync.Mutex // хандалтыг зохицуулагч обект
    n  int
}

func (a *AtomicInt) Add(n int) {
    a.mu.Lock() // хандалтыг түгжих, зөвхөн нэг функц зөвшөөрнө​
    a.n += n
    a.mu.Unlock() //  түгжээг тайлах
}

func (a *AtomicInt) Value() int {
    a.mu.Lock()
    n := a.n
    a.mu.Unlock()
    return n
}

func lockItUp() {
    wait := make(chan struct{})
    var n AtomicInt

    go func() {
        n.Add(1) // нэг хандалт
        close(wait)
    }()

    n.Add(1) // өөр нэг зэрэг хандалт
    <-wait

    fmt.Println(n.Value()) // гаралт: 2
}
```
