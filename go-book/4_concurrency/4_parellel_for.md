# Параллел давталт

Массив зэрэг өгөгдлийн олонлог дээр нэгэн зэрэг боловсруулалт хийж хугацаа хожих шаардлага олон гардаг. C#, Fortress зэрэг бусад хэлэнд параллел давталт гүйцэтгэхэд зориулсан тусгай заавар байдаг, харин Go хэлэнд үүнийг тусгай зааваргүйгээр хялбархан хийж болно. Дараах хэлбэрийн `for` давталтыг go функцтэй хослуулан хэрэглэж болно:

```go
for i, v := range data {
  go func (i int, v float64) {
		 doSomething(i, v)
		 ...
  } (i, v)
}
```

Параллел давталт ашигласнаар хугацаа маш их хожих болно. Гэхдээ давтаж байгаа зүйлс нь хоорондоо хамааралгүй байх хэрэгтэй.

Жишээ болгон тус бүр 200 миллисекундын ажил гүйцэтгэдэг хэд хэдэн go функц зэрэгцээ ажиллуулж нэг болон олон цөмтэй процессор дээр нийт ажиллах хугацааг нь харьцуулая. Цөмийн тоог тохируулахдаа `runtime.GOMAXPROCS()` функцийг ашиглаж болно. Энэ функцийг `main()` функцийн эхэнд дуудах хэрэгтэй.

200 миллисекундын зохиомол ажил (sleep функц ашиглан) гүйцэтгэх `doJob()` нэртэй функц үүсгэе. Энэ функцийг 50 удаа зэрэгцээ дуудаж ажиллуулая.

```go
package main
import "time"

func doJob(quit chan int) {
    // 200 ms-н ажил
    time.Sleep(time.Millisecond * 200)
    quit <- 1
}

func main() {
    routineQuit := make(chan int)

    for i:=0; i<50; i++ {
      go doJob(routineQuit)
    }

    // бүх функцээс дууссан дохио хүлээх
    for i:=0; i<50; i++ {
     <-routineQuit
    }
}
```

Нийт хугацааг зөв хэмжихийн тулд бүх функцийн ажиллагаа дуустал `main()` функц хүлээх хэрэгтэй болно. Үүнийг шийдэхийн тулд `routineQuit` нэртэй суваг үүсгэсэн байна. Уг сувгаас мессеж ирсэн үед нэг функцийн ажиллагаа дууслаа гэж тооцож болно. Ингээд нийт go функцийн тоогоор сувгаас дууссан дохио хүлээх хэрэгтэй.

Дээрх програмын ажилласан нийт хугацааг тодорхой гаргахын тулд Linux орчинд `time` програмыг ашиглаж болно.

```sh
$ time go run multicore.go
real	0m0.279s
user	0m0.071s
sys	0m0.012s
```

8 цөмтэй процессор дээр 0.279 секундын дотор 59 функц ажиллаж дууссан байна. 4 цөмтэй процессор дээр 0.325 секунд болж байсан. Ажиллах хугацааны хувьд компютерийн хүчин чадлаас хамаараад янз бүр байж болно, гол дүгнэлт бол процессорын цөмийн тоо ихсэх үед параллел давталтын нийт ажиллах хугацаа багасаж байгаа явдал юм.
