#  UDP протоколоор өгөгдөл солилцох

UDP протоколын хувьд радио бродкастыг ашиглан холболтгүй дамжуулалт хийгддэг. Өгөгдөл илгээхийн тулд эхлээд холболт хийх шаардлагагүй бөгөөд өгөгдөл нь өөрийгөө жолоодон хүрэх газраа хүрдэг. Зүйрлэвэл, нэг утаснаас нөгөө утас уруу SMS (богино мессеж) дамжуулахтай төстэй юм. Мессеж илгээгч нь хүлээн авагчтай заавал холбоо тогтоох шаардлагагүй.

Сүлжээгээр өгөгдөл дамжихдаа тухайн эгшинд боломжтой байгаа ямар нэг сувгаар дамжина (зөвхөн тийм сувгаар гэсэн хязгаарлалтгүй). Ө.х өгөгдөл нь аяллынхаа алхам бүрт өөрийн явах замыг динамикаар тодорхойлж байдаг гэсэн үг. Хэрэв аль нэгэн зам гацах, бөглөрөх, тасрах г.м асуудалтай байвал өөр замыг хайж олдог. Энэ талаараа интернэтийн сүлжээ нь “ухаалаг” дамжуулалт хийж чаддаг.

UDP протоколын хувьд хэрэв өгөгдөл замын дунд "унавал" юу ч хийх боломжгүй юм. Энэ протоколын гол ач холбогдол нь их хэмжээний өгөгдлийг хурдтай дамжуулахад байдаг. Ялангуяа зураг, дуу авиа зэрэг томоохон хэмжээний өгөгдлийг сүлжээгээр дамжуулахад ашигладаг.

## Өгөгдөл солилцох алхамууд

UDP сокет нь TCP сокеттой харьцуулахад нэлээд ялгаатай үүсгэгддэг. UDP сокетоор илгээгдсэн өгөгдөл буюу пакетууд нь өөрийгөө чиглүүлж байдаг. UDP сокет нь илгээгч, хүлээн авагчийн үүргийг нэгэн зэрэг гүйцэтгэнэ. UDP сокет үүсгэхэд `DatagramSocket` классыг ашиглана.

Илгээгчийн тохиолдолд:

* Датаграм сокет обект үүсгэнэ;
* Датаграм пакет үүсгэнэ;
* Датаграм пакетаа илгээнэ.

Хүлээн авагчийн тохиолдолд:

* Тодорхой порт дээр хүлээх датаграм сокет үүсгэнэ;
* Өгөгдлийг хүлээн авахад хүрэлцэхүйц хэмжээтэй буфер бүхий датаграм пакет бэлдэнэ;
* Датаграм пакетаа хүлээн авна.

Жишээ болгон өмнөх `DaytimeServer`-г UDP протоколоор ажилладаг болгон өөрчлөе.

```go
// UDPTimeServer.go
package main

import (
  "fmt"
  "net"
  "os"
  "time"
)

func main() {
	service := ":1200"
	udpAddr, err := net.ResolveUDPAddr("udp", service)
	checkError(err)
	conn, err := net.ListenUDP("udp", udpAddr)
	checkError(err)
	for {
		handleClient(conn)
	}
}

func handleClient(conn *net.UDPConn) {
	var buf [512]byte
	_, addr, err := conn.ReadFromUDP(buf[0:])
	if err != nil {
		return
	}
	fmt.Println(addr, " хаягаас хүсэлт ирлээ")
	daytime := time.Now().String()
	conn.WriteToUDP([]byte(daytime), addr)
}

func checkError(err error) {
	if err != nil {
		fmt.Fprintf(os.Stderr, "Fatal error ", err.Error())
		os.Exit(1)
	}
}
```

Одоо дээрх UDP сервер програмтай холбогдон ажиллах клиент програмыг бичие.

```go
// UDPTimeClient.go
package main

import (
  "fmt"
  "net"
  "os"
)

func main() {
	service := "localhost:1200"
	udpAddr, err := net.ResolveUDPAddr("udp", service)
	checkError(err)

	conn, err := net.DialUDP("udp", nil, udpAddr)
	checkError(err)

	_, err = conn.Write([]byte("хүсэлт"))
	checkError(err)

	var buf [512]byte
	n, err := conn.Read(buf[0:])
	checkError(err)

	fmt.Println("Серверийн хариу", string(buf[0:n]))
	os.Exit(0)
}

func checkError(err error) {
	if err != nil {
		fmt.Fprintf(os.Stderr, "Алдаа ", err.Error())
		os.Exit(1)
	}
}
```

Програмыг ажилуулах:

Эдгээр програмыг туршихдаа эхлээд нэг терминал (командын мөр) дээр `UDPTimeServer` програмыг ажиллуулна. Дараа нь өөр нэг терминал дээрээс `UDPTimeClient` програмыг ажиллуулна.

Хэрэв сүлжээний орчинд турших бол клиент кодонд байгаа “localhost:1200” хаягийг солих хэрэгтэй. Мөн 1200 портыг галт ханаар хаагаагүй байх ёстойг анхаараарай.

Програмын ажиллагааг дараах зурагт харуулсан байна.

TODO:
